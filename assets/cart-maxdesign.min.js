/*!
 * Copyright MaxDesign. All Rights Reserved. 
  ⚠ FR : CONTENU PROTÉGÉ PAR LES DROITS D'AUTEURS (article L. 111-1 du code de la propriété intellectuelle). Cette ressource ne peut pas être utilisée, diffusée ou exploitée sans l'approbation de ses auteurs. Pour plus d'informations, veuillez contacter admin(at)maxdesign.expert
  ⚠ EN : CONTENT PROTECTED WITH AUTHOR COPYRIGHTS (section L. 111-1 of the intellectual property code). This resource may not be used, distributed or exploited without the approval of its authors. For any information request, please contact admin(at)maxdesign.expert
 */
window.MaxDesign=window.MaxDesign||{};class Drawer extends HTMLElement{constructor(){super(),MaxDesign.drawer=this,this.settings=JSON.parse(this.querySelector(':scope > [type="application/json"]').innerHTML),this.setVariables(),this.setEvents()}setVariables(){this.selectors={cartWrapper:document.querySelector(".cart-drawer__wrapper"),bundles:document.querySelector("bundles-maxdesign")},this.classes={drawerOpen:"cart-drawer__open",drawerClose:".cart__close, overlay-maxdesign, .cart__continue--shopping, .cart__back--shopping",drawerEmpty:".cart-drawer__wrapper:empty"}}setEvents(){this.onFormSubmit(),this.onOpenDrawer()}onFormSubmit(){this.selectors.bundles||document.addEventListener("click",event=>{    if (window.bcpoRan) {return;}    for(let btn of document.querySelectorAll(this.settings.drawerFormSubmit)){let form=btn.closest('form[action*="/cart/add"]');form&&btn.contains(event.target)&&!this.unvalidForm(form)&&(event.preventDefault(),event.stopImmediatePropagation(),this.submitForm(form,btn),this.btnAnimate(!0,btn))}},!0)}onOpenDrawer(){document.addEventListener("click",event=>{for(let trigger of document.querySelectorAll(this.settings.drawerTrigger))trigger.contains(event.target)&&(event.preventDefault(),event.stopImmediatePropagation(),document.querySelector(this.classes.drawerEmpty)?this.fetchCart():this.openDrawer())},!0),addEventListener("load",()=>{for(let trigger of document.querySelectorAll(this.settings.drawerTrigger))trigger.addEventListener("mouseover",event=>{event.preventDefault(),event.stopImmediatePropagation()},!0)})}onCloseDrawer(){for(let closeDrawer of document.querySelectorAll(this.classes.drawerClose))closeDrawer.addEventListener("click",e=>{e.preventDefault(),document.body.classList.remove(this.classes.drawerOpen)})}submitForm(form,btn){let formData=new FormData(form);fetch("/cart/add.js",{body:formData,method:"POST"}).then(()=>this.fetchCart(btn)).catch(console.error)}unvalidForm(form){return[...form.querySelectorAll("input[name], select[name]")].find(field=>field.hasAttribute("required")&&field.matches('[type="text"]')&&""==field.value||!field.matches('[type="text"]')&&""==field.value)}btnAnimate(load,btn){if(load&&btn){btn.querySelector("[data-spinner]")||(btn.innerHTML=`<span>${btn.innerHTML}</span>`,btn.insertAdjacentHTML("beforeend",'<svg viewBox="0 0 20 20" data-spinner><path d="M20 10c0 5.523-4.477 10-10 10S0 15.523 0 10 4.477 0 10 0v2c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8h2z"></path></svg>')),btn.dataset.cartLoader="loading";for(let loader of document.querySelectorAll("[data-cart-loader]"))loader.dataset.cartLoader="loading"}else if(!load&&btn){btn.dataset.cartLoader="";for(let loader of document.querySelectorAll("[data-cart-loader]"))loader.dataset.cartLoader=""}}fetchCart(btn=null){fetch("/cart?view=drawer").then(response=>response.text()).then(html=>{const section=(new DOMParser).parseFromString(html,"text/html").body.innerHTML;this.selectors.cartWrapper.innerHTML=section,document.dispatchEvent(new Event("fetchCart")),this.openDrawer(),this.onCloseDrawer(),this.btnAnimate(!1,btn)}).catch(alert)}openDrawer(){document.body.classList.add(this.classes.drawerOpen)}}class Cart extends HTMLElement{constructor(){super(),MaxDesign.cart=this,this.settings=JSON.parse(this.querySelector(':scope > [type="application/json"]').innerHTML),this.setVariables(),this.setEvents()}setVariables(){this.selectors={price:{subtotal:this.querySelector(".summary__price--subtotal"),total:this.querySelector(".summary__price--total"),delivery:this.querySelector(".summary__price--delivery"),savings:this.querySelector(".summary__savings--price")},discount:{remove:this.querySelector(".summary__total--discount-tag svg.summary__total--discount-close"),title:this.querySelector(".summary__total--discount-title"),text:this.querySelector(".cartDiscount__text"),price:this.querySelector(".summary__price--discount"),field:this.querySelector(".cartDiscount"),btn:this.querySelector(".cartDiscount button"),fieldInput:this.querySelector(".cartDiscount input:not([type=hidden]"),submitInput:this.querySelector(".cartDiscount input[name=discount]")},offer:{progress:this.querySelector(".upsell-threshold__progress"),text:this.querySelector(".upsell-threshold__text"),goalText:this.querySelector(".upsell-threshold__text span")},timer:this.querySelector("#cdTimerCart"),cartItems:this.querySelectorAll(".cartItems__container"),qtyButtons:this.querySelectorAll(".cartItems__quantity--controls"),qtyDropdown:this.querySelectorAll(".cartItems__quantity .quantity-dropdown"),removeItems:this.querySelectorAll(".cartItems__close, .cartItems__bin"),summaryDetails:this.querySelector(".summary__total--details"),summarySavings:this.querySelector(".summary__savings"),stickyATC:this.querySelector(".btnCart__sticky"),btnATC:this.querySelector(".btnCart"),terms:this.querySelector(".cart__terms"),sentinelBottom:this.querySelector(".cart__sentinel--bottom"),cartMessageWrapper:this.querySelector(".cartMessage__wrapper"),section:this.parentElement,cartCount:document.querySelectorAll(this.settings.cartCountSelector),cartIndication:document.querySelectorAll(this.settings.cartIndicationSelector)},this.classes={removeItem:"cartItems__container--remove",btnShadow:"btnCart__sticky--shadow",btnLoading:"btnCart--loading",discountLoading:"discount__svg--loading",summaryTotalDetails:"summary__total--details-discount",hidePromoField:"cartDiscount__hidden",hideMsgBar:"cartMessage__wrapper--hidden",hideSavings:"summary__savings--hidden",barOffset:"upsell-threshold__progress--offset",cartLoading:"cart-loading",cartIndicationOn:this.settings.cartIndicationOn,cartIndicationOff:this.settings.cartIndicationOff}}setEvents(){this.settings.cart.item_count>0&&(this.onInit(),this.onUpdateQty(),this.onSubmitCart(),this.onSubmitDiscount(),this.onCookieDiscount(),this.onRemoveDiscount(),this.onCdTimer())}onInit(){this.settings.discount.qtyManual&&this.solveSwapCart(),this.settings.offer.enable&&this.refreshOffer(this.settings.offer.type),this.observeStickyBtn(),this.iosFixes(),this.updateCount(),this.discountBtnStatus()}onUpdateQty(){for(let select of this.selectors.qtyDropdown)select.addEventListener("change",e=>{let item=e.target.closest("[data-item-line]"),qty=parseInt(select.value,10),qtyMax=+e.target.dataset.quantityMax;!qtyMax||qty<=qtyMax?(select.previousElementSibling.querySelector("input").value=qty,item.dataset.itemQty=qty,this.changeCart(qty,item)):(alert(this.settings.inventoryAlert),this.cartLoader(),this.cartRefresh())});for(let button of this.selectors.qtyButtons){let input=button.querySelector("input");button.addEventListener("click",e=>{if(this.diffTime,this.lastClick,this.monitorClicks(e)){let item=e.target.closest("[data-item-line]"),qty=parseInt(input.value,10);if(e.target.hasAttribute("data-decrement"))qty=isNaN(qty)?0:qty,qty--,input.value=qty,item.dataset.itemQty=qty,button.nextElementSibling.value=qty,this.changeCart(qty,item);else if(e.target.hasAttribute("data-increment")){let qtyMax=+e.target.dataset.quantityMax;qty=isNaN(qty)?0:qty,qty++,!qtyMax||qty<=qtyMax?(input.value=qty,item.dataset.itemQty=qty,button.nextElementSibling.value=qty,this.changeCart(qty,item)):(alert(this.settings.inventoryAlert),this.cartLoader(),this.cartRefresh())}}})}for(let el of this.selectors.removeItems)el.addEventListener("click",e=>{e.preventDefault(),e.stopImmediatePropagation();let item=e.target.closest("[data-item-line]");item.dataset.itemQty=0,this.changeCart(0,item)})}onSubmitCart(){   document.addEventListener("click",e=>{  if(this.selectors.btnATC.contains(e.target)){let allowSubmit;(!this.selectors.terms||this.selectors.terms.querySelector("input").checked)&&(this.selectors.btnATC.classList.add(this.classes.btnLoading),"default"!=this.settings.appsDisable&&(e.preventDefault(),e.stopImmediatePropagation(),window.location.href=this.selectors.discount.submitInput&&""!=this.selectors.discount.submitInput.value?"/checkout?discount="+this.selectors.discount.submitInput.value:"/checkout"))}},"force_2"==this.settings.appsDisable)}onSubmitDiscount(){if(!this.settings.discount.auto){function discountWarning(){this.selectors.discount.text.classList.add("show"),this.selectors.discount.btn.disabled=!0,this.selectors.discount.submitInput.value=this.selectors.discount.fieldInput.value,this.updateSummary(!1)}this.settings.discount.custom?this.selectors.discount.btn.addEventListener("click",()=>{for(const[discount,codes]of Object.entries(this.settings.discount.discounts))for(let code of codes)if(code==this.selectors.discount.fieldInput.value)return this.selectors.discount.submitInput.value=this.selectors.discount.fieldInput.value,this.settings.cart.custom_discount=+discount,this.discountBtnStatus(!0),this.cookieDiscount(!0,this.selectors.discount.fieldInput.value),void setTimeout(()=>this.updateSummary(!0,!0),750);discountWarning.bind(this)()}):this.selectors.discount.fieldInput.addEventListener("focus",discountWarning.bind(this))}}onCookieDiscount(){if(!this.settings.discount.auto&&this.settings.discount.custom&&document.cookie.match(/^(.*;)?\s*discount_code\s*=\s*[^;]+(.*)?$/)){let discount_code=this.getCookie("discount_code");for(const[discount,codes]of Object.entries(this.settings.discount.discounts))for(let code of codes)if(code.toUpperCase()==discount_code.toUpperCase())return this.selectors.discount.submitInput.value=code,this.settings.cart.custom_discount=+discount,this.discountBtnStatus(!0),void this.updateSummary(!0,!0)}}onRemoveDiscount(){this.selectors.discount.remove&&this.selectors.discount.remove.addEventListener("click",()=>{this.selectors.discount.submitInput.value="",this.settings.cart.custom_discount=0,this.updateSummary(!1),this.cookieDiscount(!1),this.selectors.discount.text.classList.remove("show")})}onCdTimer(){if(this.settings.cdTimer.enabled){var totalTime=60*this.settings.cdTimer.time*1e3;if(document.cookie.match(/^(.*;)?\s*cdTime\s*=\s*[^;]+(.*)?$/)||null==this.selectors.timer){if(this.selectors.timer){var firstTimeValue=Date.parse(document.cookie.replace(/(?:(?:^|.*;\s*)firstTime\s*\=\s*([^;]*).*$)|^.*$/,"$1")),currentTime,usedTime=Date.parse(new Date)-firstTimeValue,runTimer=new Date(Date.parse(new Date)+(totalTime-usedTime));initializeClock.bind(this,"cdTimerCart",runTimer)()}}else{var firstTime=new Date;function cookieTimer(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+60*exdays*1e3+totalTime);var expires=0==this.settings.cdTimer.expiry?";":";expires="+d.toUTCString();document.cookie=cname+"="+cvalue+expires+"path=/"}cookieTimer.bind(this,"firstTime",firstTime,this.settings.cdTimer.expiry)(),cookieTimer.bind(this,"cdTime",totalTime,this.settings.cdTimer.expiry)();var deadline=new Date(Date.parse(new Date)+totalTime);initializeClock.bind(this,"cdTimerCart",deadline)()}function getTimeRemaining(endtime){var t=Date.parse(endtime)-Date.parse(new Date),seconds=Math.floor(t/1e3%60),minutes=Math.floor(t/1e3/60%60),hours=Math.floor(t/36e5%24),days;return{total:t,days:Math.floor(t/864e5),hours:hours,minutes:minutes,seconds:seconds}}function initializeClock(id,endtime){var clock=document.getElementById(id);if(clock){var minutesSpan=clock&&clock.querySelector("#cart_minutes"),secondsSpan=clock&&clock.querySelector("#cart_seconds"),pageLoad=!0;function updateClock(){var t=getTimeRemaining(endtime);minutesSpan.innerHTML=("0"+t.minutes).slice(-2),secondsSpan.innerHTML=("0"+t.seconds).slice(-2),t.total<=0||isNaN(t.total)?(clearInterval(timeinterval),this.selectors.timer.nextElementSibling&&"HR"==this.selectors.timer.nextElementSibling.nodeName&&this.selectors.timer.nextElementSibling.remove(),this.selectors.timer.remove()):pageLoad&&(this.selectors.timer.classList.add("cdTimerCart--active"),pageLoad=!1)}updateClock.bind(this)();var timeinterval=setInterval(updateClock.bind(this),1e3)}}}}addToCart(data,callback,loader){loader&&this.cartLoader(),fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:data})}).then(response=>response.json()).then(callback).catch(console.error)}changeCart(qty,item,key,allowSwap=!0){if(this.priorCartChange(qty,allowSwap,item,key))return;let bodyData=item?{quantity:qty,line:item.dataset.itemLine}:{quantity:qty,id:key};fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(bodyData)}).then(data=>data.json()).then(newCart=>{let reloadCart;this.solveReloadCart(qty,newCart)||this.renderCart(qty,item)}).catch(console.error)}priorCartChange(qty,allowSwap,item,key){if(0==qty)this.cartLoader();else{if(this.settings.discount.qtyManual&&item.dataset.offerId&&allowSwap)return this.solveSwapCart(qty,item,key),!0;this.settings.offer.enable&&"shipping"!=this.settings.offer.type&&this.cartLoader(!1)}}renderCart(qty,item){this.updateCount(),this.settings.offer.enable&&this.refreshOffer(this.settings.offer.type),this.updateLineItems(qty,item),this.updateSummary()}solveSwapCart(qty,item,key){let offerItems=item?this.querySelectorAll(`[data-offer-id="${item.dataset.offerId}"]`):this.querySelectorAll("[data-offer-id]");if(offerItems.length){let offerSets=[...offerItems].reduce((obj,item)=>{let key=item.dataset.offerId;return obj[key]=obj[key]||{},obj[key].qty=(obj[key].qty||0)+ +item.dataset.itemQty,obj[key].itemDiscounts=item.dataset.itemDiscounts,obj[key].discountValues=(obj[key].discountValues||[]).concat([item.dataset.discountValue]),obj},{});for(let[offerId,cart]of Object.entries(offerSets)){let promoValuesList=cart.itemDiscounts.split(","),promoValue=promoValuesList[Math.min(cart.qty-1,promoValuesList.length-1)],needSwapCart;if(!cart.discountValues.every(discount=>discount==promoValue))return this.cartLoader(),void this.swapCart(offerId,promoValue)}item&&this.changeCart(qty,item,key,!1)}this.cartLoader(!1,!1)}swapCart(offerId,promoValue){let allItems=[...this.selectors.cartItems],promoItems,promoIndex=+allItems.filter(el=>+el.dataset.offerId==offerId)[0].dataset.discountPosition,variantsToAdd=[];for(let item of allItems)if(item.dataset.offerId==offerId){let itemData=JSON.parse(item.querySelector("[data-variant]").textContent),currentOptions=itemData.currentOptions,variants=itemData.variants;for(let variant of variants)variant.options.includes(promoValue)&&(variant.options.splice(promoIndex,1),currentOptions.splice(promoIndex,1),variant.options.every(option=>currentOptions.includes(option))&&variantsToAdd.push({quantity:+item.dataset.itemQty,id:variant.id}))}else variantsToAdd.push({quantity:+item.dataset.itemQty,id:+item.dataset.itemId});this.resetCart(variantsToAdd.reverse())}resetCart(variantsToAdd){fetch("/cart/clear.js",{method:"POST"}).then(response=>response.json()).then(()=>this.addToCart(variantsToAdd,this.cartRefresh.bind(this),!0)).catch(console.error)}updateLineItems(qty,item){let product={total:item.querySelector(".cartItems__prices-total"),compare_price:item.querySelector(".cartItems__prices--compare")};product.total.innerHTML=0==product.total.dataset.price?this.settings.free:this.formatMoney(product.total.dataset.price*qty),product.compare_price&&(product.compare_price.innerHTML=this.formatMoney(product.compare_price.dataset.comparePrice*qty))}updateCount(){if(this.selectors.cartCount)for(let el of this.selectors.cartCount)el.textContent=this.settings.cart.item_count;for(let el of this.selectors.cartIndication)el.classList.toggle(this.classes.cartIndicationOn,this.settings.cart.item_count>0),el.classList.toggle(this.classes.cartIndicationOff,0==this.settings.cart.item_count)}updateSummary(allowDiscount,customDiscount){this.updateDiscount(allowDiscount,customDiscount),this.updateDelivery(),this.updateSubtotal(),this.updateTotal(),this.updateSavings(),this.updateMessageBar()}updateDiscount(allowDiscount=!0,customDiscount){this.qtyDiscountIndex;let autoDiscount=this.settings.cart.total_discount>0;this.qtyDiscount=allowDiscount&&!customDiscount&&!autoDiscount&&this.settings.discount.qty.enabled;let discountValue=allowDiscount&&this.settings.cart.custom_discount||0;this.cartDiscount=autoDiscount?this.settings.cart.total_discount:Math.floor(this.settings.cart.original_total_price*discountValue/100),this.qtyDiscount&&(this.qtyDiscountIndex=Math.max(Math.min(this.settings.cart.item_count-1,3),0),discountValue=+this.settings.discount.qty.values[this.qtyDiscountIndex],this.cartDiscount=Math.floor(this.settings.cart.original_total_price*discountValue/100),this.selectors.discount.submitInput.value=this.settings.discount.qty.codes[this.qtyDiscountIndex],this.settings.cart.custom_discount=+discountValue),autoDiscount||discountValue>0?(this.selectors.discount.field.classList.add(this.classes.hidePromoField),this.selectors.summaryDetails.classList.add(this.classes.summaryTotalDetails),this.selectors.discount.price.innerHTML="- "+this.formatMoney(this.cartDiscount),!autoDiscount&&(this.selectors.discount.title.textContent=this.selectors.discount.submitInput.value)):(this.settings.discount.promoField&&this.selectors.discount.field.classList.remove(this.classes.hidePromoField),this.selectors.summaryDetails.classList.remove(this.classes.summaryTotalDetails))}updateDelivery(){if(this.deliveryAmount=this.settings.offer.shipping.defaultPrice,"shipping"==this.settings.offer.type||"both"==this.settings.offer.type){let threshold=this.settings.offer.shipping.thresholdValue;this.deliveryThresholdMet=this.settings.cart.original_total_price>=threshold,this.deliveryAmount=this.deliveryThresholdMet?this.settings.offer.shipping.priceAfter:this.settings.offer.shipping.priceBefore,this.deliveryAmount=this.deliveryAmount.replace(/[,.]/g,""),this.selectors.price.delivery&&(this.selectors.price.delivery.innerHTML=isNaN(+this.deliveryAmount)?this.deliveryAmount:this.formatMoney(+this.deliveryAmount)),this.deliveryAmount=isNaN(+this.deliveryAmount)?0:+this.deliveryAmount}}updateSubtotal(){this.selectors.price.subtotal.innerHTML=this.formatMoney(this.settings.cart.original_total_price)}updateTotal(){this.selectors.price.total.innerHTML=this.formatMoney(this.settings.cart.original_total_price-(this.cartDiscount||0)+this.deliveryAmount)}updateSavings(){if(this.selectors.summarySavings){let totalCPValue=0;for(let item of this.selectors.cartItems){let qtyValue=+item.dataset.itemQty,comparePriceValue;totalCPValue+=(item.querySelector("[data-compare-price]")?+item.querySelector("[data-compare-price]").dataset.comparePrice:+item.querySelector("[data-price]").dataset.price)*qtyValue}let savings=Math.round((this.cartDiscount||0)+totalCPValue-this.settings.cart.original_total_price);savings>0?(this.selectors.price.savings.innerHTML=this.formatMoney(savings),this.selectors.summarySavings.classList.remove(this.classes.hideSavings)):this.selectors.summarySavings.classList.add(this.classes.hideSavings)}}updateMessageBar(){let msgWrapper=this.selectors.cartMessageWrapper;if(msgWrapper){if(this.qtyDiscount&&""!=this.settings.discount.qty.messages[this.qtyDiscountIndex])return msgWrapper.firstElementChild.innerHTML=this.settings.discount.qty.messages[this.qtyDiscountIndex],void msgWrapper.classList.remove(this.classes.hideMsgBar);if(this.settings.announce.enabled&&""!=this.settings.announce.text)return msgWrapper.firstElementChild.innerHTML=this.settings.announce.text,void msgWrapper.classList.remove(this.classes.hideMsgBar);msgWrapper.classList.add(this.classes.hideMsgBar)}}refreshOffer(type){switch(type){case"both":let type_step1=this.settings.offer.both.step_1,type_step2=this.settings.offer.both.step_2;if(this.getOfferProgress(type_step2)>=100)this.updateOffer(this.settings.offer.qualify,type_step2,!1,!0,!0,!0);else if(this.getOfferProgress(type_step1)>=100){let getOffer="shipping"==type_step1;this.updateOffer(this.settings.offer[type_step2].text,type_step2,!0,getOffer,!getOffer)}else this.updateOffer(this.settings.offer[type_step1].text,type_step1,!0,!1,!1);break;default:this.getOfferProgress(type)>=100?this.updateOffer(this.settings.offer.qualify,type,!1,!0,!0):this.updateOffer(this.settings.offer[type].text,type,!0,!1,!1)}this.cartLoader(!1,!1),this.animateBarOffer(this.settings.offer.type)}getOfferProgress(type){return this.offerTotal=this.settings.cart.original_total_price,"shipping"!=type&&(this.productsInCartQty=0,this.productsInCart=this.settings.cart.items.filter(item=>{if(this.settings.offer.product.id==item.variant_id)return this.offerTotal-=item.original_line_price,this.productsInCartQty+=item.quantity,!0})),100*this.offerTotal/this.settings.offer[type].thresholdValue}updateOffer(text,type,showBar,offerShipping,offerProduct,check){let moneyGoal=this.formatMoney(this.settings.offer[type].thresholdValue-this.settings.cart.original_total_price),threshold=this.formatMoney(this.settings.offer[type].thresholdValue);switch(setTimeout(()=>{this.selectors.offer.text.innerHTML=text.replace("XX",moneyGoal).replace("YY",threshold),this.selectors.section.style.setProperty("--upsell-bar-display",showBar?"flex":"none")},showBar?0:700),this.settings.offer.type){case"product":this.updateProductOffer(offerProduct);break;case"shipping":this.updateDelivery(),this.updateTotal(),this.updateSavings();break;default:this.updateProductOffer(offerProduct),this.updateDelivery(),this.updateTotal(),this.updateSavings()}}updateProductOffer(offerProduct){offerProduct&&!this.productsInCart.length&&this.settings.offer.product.id&&!this.productOfferAdded?(this.productOfferAdded=!0,setTimeout(()=>{this.addToCart([{quantity:1,id:this.settings.offer.product.id,properties:this.settings.offer.product.prop}],this.cartRefresh.bind(this),!0)},500)):(!offerProduct&&this.productsInCart.length||this.productsInCartQty>1)&&this.changeCart(0,null,this.productsInCart[0].key,!1)}animateBarOffer(type){this.selectors.offer.progress.dataset.progress=this.formatMoney(this.settings.cart.original_total_price).replace(/<\/?[^>]+(>|$)/g,""),this.selectors.offer.progress.style.width=this.getBarProgress(type)+"%"}getBarProgress(type){let threshold="both"==type?this.settings.offer[this.settings.offer.both.step_2].thresholdValue:this.settings.offer[type].thresholdValue,progress=100*this.offerTotal/threshold,iconProgress=+this.settings.offer.both.iconProgress,isOffset="both"==type&&progress>iconProgress&&progress-iconProgress<3;return this.selectors.section.style.setProperty("--upsell-price-transition",progress>=100?".25s":".4s .3s"),this.selectors.offer.progress.classList.toggle(this.classes.barOffset,isOffset),progress}formatMoney(cents){"string"==typeof cents&&(cents=cents.replace(".",""));var value="",placeholderRegex=/\{\{\s*(\w+)\s*\}\}/,formatString=this.settings.moneyFormat;function defaultOption(opt,def){return void 0===opt?def:opt}function formatWithDelimiters(number,precision,thousands,decimal){if(precision=defaultOption(precision,2),thousands=defaultOption(thousands,","),decimal=defaultOption(decimal,"."),isNaN(number)||null==number)return 0;var parts=(number=(number/100).toFixed(precision)).split("."),dollars,cents;return parts[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+thousands)+(parts[1]?decimal+parts[1]:"")}switch(formatString.match(placeholderRegex)[1]){case"amount":value=formatWithDelimiters(cents,2);break;case"amount_no_decimals":value=formatWithDelimiters(cents,0);break;case"amount_with_comma_separator":value=formatWithDelimiters(cents,2,".",",");break;case"amount_no_decimals_with_comma_separator":value=formatWithDelimiters(cents,0,".",",")}return formatString.replace(placeholderRegex,value)}observeStickyBtn(){let observer=new IntersectionObserver(entry=>{entry[0].target==this.selectors.sentinelBottom&&(entry[0].isIntersecting?this.selectors.stickyATC.classList.remove(this.classes.btnShadow):this.selectors.stickyATC.classList.add(this.classes.btnShadow))});this.selectors.sentinelBottom&&observer.observe(this.selectors.sentinelBottom)}iosFixes(){window.onpageshow=event=>{event.persisted&&this.selectors.btnATC.classList.remove(this.classes.btnLoading)}}monitorClicks(event){if(this.lastClick){if(this.diffTime=event.timeStamp-this.lastClick,!(this.diffTime>=400))return console.warn("Too many simultaneous requests"),!1;this.lastClick++}return this.lastClick=event.timeStamp,!0}getCookie(name){let v=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");return v?v[2]:null}discountBtnStatus(loading=!1){if(!this.settings.discount.auto&&this.selectors.discount.fieldInput){if(loading)return this.selectors.discount.btn.classList.add(this.classes.discountLoading),void setTimeout(()=>{this.selectors.discount.fieldInput.value="",this.selectors.discount.btn.disabled=!0,this.selectors.discount.btn.classList.remove(this.classes.discountLoading),this.selectors.discount.field.classList.add(this.classes.hidePromoField)},750);this.selectors.discount.fieldInput.addEventListener("keyup",e=>{e.currentTarget.nextElementSibling.disabled=""==this.value,this.selectors.discount.submitInput.value=this.selectors.discount.fieldInput.value,13===e.keyCode&&(e.preventDefault(),this.selectors.discount.btn.click())})}}cookieDiscount(addCookie,code){if(addCookie){let date=new Date;date.setTime(date.getTime()+36e5),document.cookie=`discount_code=${code}; expires=${date.toUTCString()}; path=/`}else document.cookie="discount_code=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}solveReloadCart(qty,newCart){const wasAutoDiscount=this.settings.cart.total_discount>0;Object.assign(this.settings.cart,newCart);const isAutoDiscount=this.settings.cart.total_discount>0;if(isAutoDiscount||wasAutoDiscount)return this.cartLoader(),this.cartRefresh(),!0;if(0==qty){for(let item of this.settings.cart.items.values())if(item.properties._url_original){let originalItemInCart;if(!Object.values(this.settings.cart.items).find(originalItem=>item.sku==originalItem.sku&&!originalItem.properties._url_original))return this.changeCart(0,null,item.key,!1),!0}return this.cartRefresh(),!0}return!1}cartLoader(load=!0,disable=!0){load&&this.selectors.section.classList.add(this.classes.cartLoading),this.selectors.btnATC.disabled=disable}cartRefresh(){this.updateCount(),"drawer"==this.settings.cartType?MaxDesign.drawer.fetchCart():location.reload.bind(window.location)()}}class Upsell extends HTMLElement{constructor(){super(),this.childNodes.length&&(MaxDesign.upsell=this,this.settings=JSON.parse(this.querySelector(':scope > [type="application/json"]').innerHTML),this.setVariables(),this.setEvents())}setVariables(){this.selectors={btn:this.querySelector(".upsell__submit")},this.classes={btnLoading:"upsell__submit--loading"}}setEvents(){this.onAddUpsell()}onAddUpsell(){this.selectors.btn.addEventListener("click",e=>{e.currentTarget.classList.add(this.classes.btnLoading),this.settings.replaceItem?fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:0,id:this.settings.refID})}).then(()=>{MaxDesign.cart.addToCart([{quantity:1,id:this.settings.upsellID,properties:this.settings.upsellProp}],MaxDesign.cart.cartRefresh.bind(MaxDesign.cart),!1)}).catch(alert):MaxDesign.cart.addToCart([{quantity:1,id:this.settings.upsellID,properties:this.settings.upsellProp}],MaxDesign.cart.cartRefresh.bind(MaxDesign.cart),!1)})}}customElements.define("drawer-maxdesign",Drawer),customElements.define("cart-maxdesign",Cart),customElements.define("upsell-maxdesign",Upsell);